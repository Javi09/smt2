/**
 * (smt)2 simple mouse tracking - record mode
 * Copyleft (cc) 2006-2009 Luis Leiva
 * Release date: September 12th 2009
 * http://smt.speedzinemedia.com
 */
(function(){var f={fps:24,recTime:120,smtPath:"/smt2",warn:false,warnText:"We'd like to track your mouse activity\nin order to improve this website's usability.\nDo you agree?",cookieDays:365,initFn:null,disabled:0};var c=window.smtAuxFn;if(typeof c==="undefined"){throw ("auxiliar (smt)2 functions not found")}var b=window.smtRecordingOptions;if(typeof b!=="undefined"){c.overrideTrackingOptions(f,b)}var d=document.getElementsByTagName("script");for(var e=0,n=d.length;e<n;++e){var a=d[e].src;if(/smt-record/i.test(a)){var m=a.split("/");var g=c.array.indexOf(m,"smt2");if(g&&f.smtPath===null){f.smtPath=m.slice(0,g+1).join("/")}}}var k={i:0,mouse:{x:0,y:0},viewport:{width:0,height:0},discrepance:{x:1,y:1},coords:{x:[],y:[]},clicks:{x:[],y:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,append:null,paused:false,clicked:false,timeout:f.fps*f.recTime,xmlhttp:c.createXMLHTTPObject(),firstTimeUser:1,pauseRecording:function(){k.paused=true},continueRecording:function(){k.paused=false},normalizeData:function(){var i=c.getWindowSize();k.discrepance.x=c.roundTo(i.width/k.viewport.width);k.discrepance.y=c.roundTo(i.height/k.viewport.height)},getMousePos:function(i){if(!i){i=window.event}if(i.pageX||i.pageY){k.mouse.x=i.pageX;k.mouse.y=i.pageY}else{if(i.clientX||i.clientY){k.mouse.x=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;k.mouse.y=i.clientY+document.body.scrollTop+document.documentElement.scrollTop}}},setClick:function(){k.clicked=true},releaseClick:function(){k.clicked=false},recMouse:function(){if(k.paused){return}if(k.i<k.timeout){var i=Math.round(k.discrepance.x*k.mouse.x);var o=Math.round(k.discrepance.y*k.mouse.y);if(i&&o){k.coords.x.push(i);k.coords.y.push(o);if(!k.clicked){k.clicks.x.push(null);k.clicks.y.push(null)}else{k.clicks.x.push(i);k.clicks.y.push(o)}}}else{clearInterval(k.rec);clearInterval(k.append)}++k.i},initMouseData:function(){k.updateViewPort();var i="url="+k.url;i+="&urltitle="+document.title;i+="&cookies="+document.cookie;i+="&bname="+c.browserDetect.browser;i+="&bversion="+c.browserDetect.version;i+="&bos="+c.browserDetect.OS;i+="&bua="+navigator.userAgent;i+="&screenw="+screen.width;i+="&screenh="+screen.height;i+="&vpw="+k.viewport.width;i+="&vph="+k.viewport.height;i+="&time="+c.roundTo(k.i/f.fps);i+="&fps="+f.fps;i+="&ftu="+k.firstTimeUser;i+="&xcoords="+k.coords.x;i+="&ycoords="+k.coords.y;i+="&xclicks="+k.clicks.x;i+="&yclicks="+k.clicks.y;i+="&elhovered="+k.elem.hovered;i+="&elclicked="+k.elem.clicked;c.sendAjaxRequest({url:f.smtPath+"/core/store.php",callback:k.setUserId,postdata:i,xmlhttp:k.xmlhttp});k.clearMouseData()},setUserId:function(i){k.userId=parseInt(i);if(k.userId>0){k.append=setInterval(k.appendMouseData,2000)}},appendMouseData:function(){if(!k.rec||k.paused){return false}var i="uid="+k.userId;i+="&time="+c.roundTo(k.i/f.fps);i+="&xcoords="+k.coords.x;i+="&ycoords="+k.coords.y;i+="&xclicks="+k.clicks.x;i+="&yclicks="+k.clicks.y;i+="&elhovered="+k.elem.hovered;i+="&elclicked="+k.elem.clicked;c.sendAjaxRequest({url:f.smtPath+"/core/append.php",postdata:i,xmlhttp:k.xmlhttp});k.clearMouseData()},clearMouseData:function(){k.coords.x=[];k.coords.y=[];k.clicks.x=[];k.clicks.y=[];k.elem.hovered=[];k.elem.clicked=[]},findElement:function(i){if(!i){i=window.event}c.widget.findDOMElement(i,function(o){if(i.type=="mousedown"){k.elem.clicked.push(o)}else{if(i.type=="mousemove"){k.elem.hovered.push(o)}}})},updateViewPort:function(){var i=c.getWindowSize();k.viewport.width=i.width;k.viewport.height=i.height},init:function(){k.updateViewPort();k.url=window.location.href;var i=Math.round(1000/f.fps);k.rec=setInterval(k.recMouse,i);c.allowTrackingOnFlashObjects();c.addEvent(document,"mousemove",k.getMousePos);c.addEvent(document,"mousedown",k.setClick);c.addEvent(document,"mouseup",k.releaseClick);c.addEvent(window,"resize",k.normalizeData);if(document.attachEvent){c.addEvent(document.body,"focusout",k.pauseRecording);c.addEvent(document.body,"focusin",k.continueRecording)}else{c.addEvent(window,"blur",k.pauseRecording);c.addEvent(window,"focus",k.continueRecording)}c.addEvent(document,"mousedown",k.findElement);c.addEvent(document,"mousemove",k.findElement);if(typeof window.onbeforeunload=="function"){c.addEvent(window,"beforeunload",k.appendMouseData)}else{c.addEvent(window,"unload",k.appendMouseData)}setTimeout(k.initMouseData,2000);if(f.initFn){f.initFn()}}};var h=c.cookies.checkCookie("isFirstTimeUser");if(f.disabled&&h){return}if(f.warn){var j=c.cookies.checkCookie("isAgreedToTrack");var l=(j)?c.cookies.getCookie("isAgreedToTrack"):window.confirm(f.warnText);if(!l){c.cookies.setCookie("isAgreedToTrack",0,1);return}}k.firstTimeUser=(!h|0);c.cookies.setCookie("isFirstTimeUser",k.firstTimeUser,f.cookieDays);c.cookies.setCookie("isAgreedToTrack",1,f.cookieDays);c.browserDetect.init();c.onDOMload(k.init)})();
