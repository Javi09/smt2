/*! 
 * (smt)2 simple mouse tracking v2.1.0
 * Copyleft (cc) 2006-2012 Luis Leiva
 * http://smt2.googlecode.com & http://smt.speedzinemedia.com
 */
(function(){var c={fps:24,recTime:120,postInterval:2,trackingServer:"/smt2/",storageServer:"",warn:false,warnText:"We'd like to track your mouse activity\nin order to improve this website's usability.\nDo you agree?",cookieDays:365,layoutType:"liquid",contRecording:true,disabled:0};var b=window.smt2fn;if(typeof b==="undefined"){throw ("auxiliar (smt)2 functions not found")}var a={i:0,mouse:{x:0,y:0},page:{width:0,height:0},discrepance:{x:1,y:1},coords:{x:[],y:[],type:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,append:null,paused:false,clicked:false,timestamp:null,timeout:null,xmlhttp:b.createXMLHTTPObject(),firstTimeUser:1,pauseRecording:function(){a.paused=true},resumeRecording:function(){a.paused=false},normalizeData:function(){var d=b.getPageSize();a.discrepance.x=b.roundTo(d.width/a.page.width);a.discrepance.y=b.roundTo(d.height/a.page.height)},getMousePos:function(g){if(!g){g=window.event}var i=g.currentTarget||g.srcElement;var f=i.document||i;var d=0,j=0;if(g.pageX||g.pageY){d=g.pageX;j=g.pageY}else{if(g.clientX||g.clientY){d=g.clientX+f.body.scrollLeft+f.documentElement.scrollLeft;j=g.clientY+f.body.scrollTop+f.documentElement.scrollTop}}var h=i.frameElement;if(h&&h.offsetParent){do{d+=h.offsetLeft;j+=h.offsetTop}while(h=h.offsetParent)}if(d<0||!d){d=0}if(j<0||!j){j=0}a.mouse.x=d;a.mouse.y=j},setClick:function(){a.clicked=true},releaseClick:function(){a.clicked=false},recMouse:function(){if(a.paused){return}if(a.i<a.timeout){var d=a.mouse.x;var e=a.mouse.y;a.coords.x.push(d);a.coords.y.push(e);if(!a.clicked){a.coords.type.push(0)}else{a.coords.type.push(1)}}else{clearInterval(a.rec);clearInterval(a.append)}++a.i},initMouseData:function(){a.computeAvailableSpace();var d="url="+a.url;d+="&urltitle="+document.title;d+="&cookies="+document.cookie;d+="&screenw="+screen.width;d+="&screenh="+screen.height;d+="&pagew="+a.page.width;d+="&pageh="+a.page.height;d+="&time="+a.getTime();d+="&fps="+c.fps;d+="&ftu="+a.firstTimeUser;d+="&xcoords="+a.coords.x;d+="&ycoords="+a.coords.y;d+="&clicks="+a.coords.type;d+="&elhovered="+a.elem.hovered;d+="&elclicked="+a.elem.clicked;d+="&action=store";d+="&remote="+c.storageServer;var e=b.ensureLastURLSlash(c.trackingServer)+"core/gateway.php";b.sendAjaxRequest({url:e,callback:a.setUserId,postdata:d,xmlhttp:a.xmlhttp});a.clearMouseData()},setUserId:function(d){a.userId=parseInt(d);if(a.userId>0){a.append=setInterval(a.appendMouseData,c.postInterval*1000)}},getTime:function(){var d=(new Date()).getTime()-a.timestamp;return d/1000},appendMouseData:function(){if(!a.rec||a.paused){return false}var d="uid="+a.userId;d+="&time="+a.getTime();d+="&pagew="+a.page.width;d+="&pageh="+a.page.height;d+="&xcoords="+a.coords.x;d+="&ycoords="+a.coords.y;d+="&clicks="+a.coords.type;d+="&elhovered="+a.elem.hovered;d+="&elclicked="+a.elem.clicked;d+="&action=append";d+="&remote="+c.storageServer;var e=b.ensureLastURLSlash(c.trackingServer)+"core/gateway.php";b.sendAjaxRequest({url:e,postdata:d,xmlhttp:a.xmlhttp});a.clearMouseData()},clearMouseData:function(){a.coords.x=[];a.coords.y=[];a.coords.type=[];a.elem.hovered=[];a.elem.clicked=[]},findElement:function(d){if(!d){d=window.event}b.widget.findDOMElement(d,function(e){if(d.type=="mousedown"){a.elem.clicked.push(e)}else{if(d.type=="mousemove"){a.elem.hovered.push(e)}}})},computeAvailableSpace:function(){var d=b.getPageSize();a.page.width=d.width;a.page.height=d.height},trackIFrames:function(k){var j=k.getElementsByTagName("iframe");for(var e=0,g=j.length;e<g;++e){var h=j[e].contentWindow||j[e].contentDocument;b.addEvent(h,"load",function(i){try{var f=i.target||i.srcElement;b.addEvent(f.document,"mousemove",function(l){a.getMousePos(l);a.pause=false})}catch(d){}a.trackIFrames(f.document);b.allowTrackingOnFlashObjects(f.document)})}},init:function(){a.computeAvailableSpace();a.url=escape(window.location.href);a.timeout=c.fps*c.recTime;var d=Math.round(1000/c.fps);a.rec=setInterval(a.recMouse,d);b.allowTrackingOnFlashObjects(document);a.trackIFrames(document);b.addEvent(document,"mousemove",a.getMousePos);b.addEvent(document,"mousedown",a.setClick);b.addEvent(document,"mouseup",a.releaseClick);b.addEvent(window,"resize",a.computeAvailableSpace);if(!c.contRecording){if(document.attachEvent){b.addEvent(document.body,"focusout",a.pauseRecording);b.addEvent(document.body,"focusin",a.resumeRecording)}else{b.addEvent(window,"blur",a.pauseRecording);b.addEvent(window,"focus",a.resumeRecording)}}b.addEvent(document,"mousedown",a.findElement);b.addEvent(document,"mousemove",a.findElement);if(typeof window.onbeforeunload=="function"){b.addEvent(window,"beforeunload",a.appendMouseData)}else{b.addEvent(window,"unload",a.appendMouseData)}setTimeout(a.initMouseData,c.postInterval*1000);a.timestamp=(new Date()).getTime()}};if(typeof window.smt2!=="undefined"){throw ("smt2 namespace conflict")}window.smt2={record:function(d){if(typeof d!=="undefined"){b.overrideTrackingOptions(c,d)}var j=b.cookies.checkCookie("smt-ftu");if(c.disabled&&j){return}a.firstTimeUser=(!j|0);b.cookies.setCookie("smt-ftu",a.firstTimeUser,c.cookieDays);if(c.warn){var k=b.cookies.checkCookie("smt-agreed");var l=(k)?b.cookies.getCookie("smt-agreed"):window.confirm(c.warnText);if(l>0){b.cookies.setCookie("smt-agreed",1,c.cookieDays)}else{b.cookies.setCookie("smt-agreed",0,1);return false}}var f=document.getElementsByTagName("script");for(var g=0,n=f.length;g<n;++g){var e=f[g].src;if(/smt-record/i.test(e)){var m=e.split("/");var h=b.array.indexOf(m,"smt2");if(h&&c.trackingServer===null){c.trackingServer=m.slice(0,h+1).join("/")}}}b.onDOMload(a.init)}}})();